# 05. Web Domain Setting
________________________________________
## 1. DNSとドメイン設定
________________________________________
やりたいこと

```text
1. あるレンタルサーバ事業者で、スペースとドメインを取得
2. 別のレンタルサーバ事業者で、VPSを構築した
3. 2で構築したVPSを、1で取得したドメインのサブドメインでアクセスできるようにする

あるレンタルサーバ = Value-domain
別のレンタルサーバ = ConoHa
```

各種意味

```text
Aレコード　：ドメインに対する実際のIPはこれです
MXレコード ：ドメインに対するメールを許可します。優先度は10です。転送先がAレコードと別にある場合はこのIPです。
TXTレコード：汎用設定。様々な用途に使われる
SPF1　　　 ：このドメインからのメールアドレスは、このIPから送信されるはずだよ（そうじゃないなら偽物だよ）

※ Value domainの場合、DSNレコードそのものとは異なる書式になる
すなわち以下のような書式になる

a <サブドメインか@> <IP>
mx <サブドメインか@> 10 [<転送先IP・エイリアス等>]
txt <サブドメインか@> v=spf1 ip4:<IP> ~all

@はそのドメインを指す
*はそのドメインを含め、すべてのサブドメインに適用する設定となる
*はサブドメインで別の設定にしたい場合、設定してはいけない
```

設定例

```text
1. Value-domainにログイン（Value serverではない）
2. ドメイン > ドメインの設定操作 > 該当ドメインの「DNS/URL」
3. DNS情報/URL転送の設定で、例えば以下のように設定

a @ 157.7.184.35
a www 157.7.184.35
a gitlab 150.95.151.169
mx @ 10
txt @ v=spf1 ip4:157.7.184.35 ~all

4. DNS設定が浸透するまで、1時間ぐらい待つ
```

補足

```text
・両レンタルサーバ事業者のドメイン設定が必要と言われるが、ドメイン発行者側だけでよい
・ドメイン設定とSSL設定は全く別である。VMまたはLBごとにSSLを設定する
・LB自体に証明書を適用するのではなくノード群に適用する場合は、それらは同じ証明書を使用するのが望ましい
・ドメインとサブドメインなどドメインが完全一致しない場合は、別々に発行してよい
    ・ワイルドカードに対応した証明書発行なら、サブドメインでも同じ証明書を使用できる
```
